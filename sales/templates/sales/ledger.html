{% extends 'base.html' %}
{% load form_tags %}
{% block title %}Ledger{% endblock %}
{% block content %}
<div class="mb-6 flex items-center justify-between">
  <div>
    <h1 class="text-3xl font-bold text-gray-800">Ledger</h1>
    <p class="text-gray-600">Combined sales and installment payments with running balance</p>
  </div>
</div>

<!-- Filters -->
<div class="bg-white rounded-lg shadow-md p-4 mb-6">
  <form method="get" class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
    <div>
      <label class="block text-sm text-gray-700 mb-1">Customer</label>
      <select name="customer" class="w-full border rounded px-3 py-2">
        <option value="">All</option>
        {% for c in customers %}
          <option value="{{ c.id }}" {% if customer_id|default:'' == c.id|stringformat:'s' %}selected{% endif %}>{{ c.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block text-sm text-gray-700 mb-1">Payment type</label>
      <select name="payment_type" class="w-full border rounded px-3 py-2">
        <option value="">All</option>
        <option value="FULL" {% if payment_type == 'FULL' %}selected{% endif %}>Full</option>
        <option value="INSTALLMENT" {% if payment_type == 'INSTALLMENT' %}selected{% endif %}>Installment</option>
      </select>
    </div>
    <div>
      <label class="block text-sm text-gray-700 mb-1">Start date</label>
      <input type="date" name="start" value="{{ start_date }}" class="w-full border rounded px-3 py-2" />
    </div>
    <div>
      <label class="block text-sm text-gray-700 mb-1">End date</label>
      <input type="date" name="end" value="{{ end_date }}" class="w-full border rounded px-3 py-2" />
    </div>
    <div>
      <button class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Apply</button>
    </div>
  </form>
</div>

<!-- Ledger Table -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
  <div class="overflow-x-auto lg:overflow-x-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Date</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Type</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Ref</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Customer</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider">Description</th>
          <th class="px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider">Debit (Rs)</th>
          <th class="px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider">Credit (Rs)</th>
          <th class="px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wider">Balance (Rs)</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {% for e in page_obj.object_list %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 whitespace-nowrap">{{ e.date|date:"Y-m-d H:i" }}</td>
          <td class="px-4 py-3">{{ e.type }}</td>
          <td class="px-4 py-3">#{{ e.ref }}</td>
          <td class="px-4 py-3">{{ e.customer }}</td>
          <td class="px-4 py-3">{{ e.description }}</td>
          <td class="px-4 py-3 text-right">Rs {{ e.debit|currency }}</td>
          <td class="px-4 py-3 text-right">Rs {{ e.credit|currency }}</td>
          <td class="px-4 py-3 text-right font-semibold">Rs {{ e.balance|currency }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="px-4 py-8 text-center text-gray-500">No entries found.</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr class="bg-gray-50">
          <td colspan="7" class="px-4 py-3 text-right font-semibold">Final Balance</td>
          <td class="px-4 py-3 text-right font-bold">Rs {{ running_final|currency }}</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<!-- Pagination -->
{% if page_obj.paginator.num_pages > 1 %}
<div class="mt-6 flex items-center justify-center gap-2">
  {% if page_obj.has_previous %}
    <a href="?page=1" class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">First</a>
    <a href="?page={{ page_obj.previous_page_number }}" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">Previous</a>
  {% endif %}
  <span class="px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">Next</a>
    <a href="?page={{ page_obj.paginator.num_pages }}" class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">Last</a>
  {% endif %}
</div>
{% endif %}
{% endblock %}
